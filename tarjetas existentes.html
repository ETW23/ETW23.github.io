<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tarjetas existentes</title>
</head>

<body>
  <script>
    const urls = {
      [2002]: "https://opendata.gijon.es/descargar.php?id=629&tipo=JSON",
      [2003]: "https://opendata.gijon.es/descargar.php?id=630&tipo=JSON",
      [2004]: "https://opendata.gijon.es/descargar.php?id=631&tipo=JSON",
      [2005]: "https://opendata.gijon.es/descargar.php?id=632&tipo=JSON",
      [2006]: "https://opendata.gijon.es/descargar.php?id=633&tipo=JSON",
      [2007]: "https://opendata.gijon.es/descargar.php?id=634&tipo=JSON",
      [2008]: "https://opendata.gijon.es/descargar.php?id=635&tipo=JSON",
      [2009]: "https://opendata.gijon.es/descargar.php?id=636&tipo=JSON",
      [2010]: "https://opendata.gijon.es/descargar.php?id=637&tipo=JSON",
      [2011]: "https://opendata.gijon.es/descargar.php?id=638&tipo=JSON",
      [2012]: "https://opendata.gijon.es/descargar.php?id=639&tipo=JSON",
      [2013]: "https://opendata.gijon.es/descargar.php?id=640&tipo=JSON",
      [2014]: "https://opendata.gijon.es/descargar.php?id=641&tipo=JSON",
      [2015]: "https://opendata.gijon.es/descargar.php?id=642&tipo=JSON",
    }

    const scale = 5;

    Promise.all(Object.values(urls).map(url => {
      return fetch(url)
        .then(response => response.json())
    })).then(responses => {
      let count = 0, max = 0;
      for (const response of responses) {
        for (const entry of response.numtarjetaciudadanas.numtarjetaciudadana) {
          if (entry.tipo === "F") {
            count++;
            if (entry.cuantos > max) {
              max = entry.cuantos;
            }
          }
        }
      }

      let svg = '<svg viewBox="0 0 ' + count * scale + ' ' + 100 * scale + '">';

      let i = 0;
      for (const response of responses) {
        for (const entry of response.numtarjetaciudadanas.numtarjetaciudadana) {
          if (entry.tipo === "F") {
            const x = i * scale;
            const y = (max - entry.cuantos) / max * 100 * scale;
            const width = scale - 1;
            const height = entry.cuantos / max * 100 * scale;
            const color = "red";
            svg += '<rect x="' + x + '" y="' + y + '" width="' + width + '" height="' + height + '" fill="' + color + '">';
            svg += '<title>' + entry.a√ëo + ' ' + entry.mes + '&ensp;&mdash;&ensp;' + entry.cuantos + ' tarjetas</title>';
            svg += '</rect>';

            i++;
          }
        }
      }

      svg += '</svg>';

      document.body.innerHTML = svg;
    })
  </script>
</body>

</html>